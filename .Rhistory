s1 <- theta
s2 <- theta + 0.5
n <- 10000
set.seed(123)
u <- rbinom(n, prob = w1, size = 1)
x <- rgamma(n, shape = ifelse(u == 1, s1, s2), scale = 1)
g <- w1 * dgamma(x, shape = s1, scale = 1) +w2 * dgamma(x, shape = s2, scale = 1)
g.true <- c * exp(-x) * (2 * x^(theta - 1) + x^(theta - 0.5))
plot(x,g)
points(x,g.true,col="red")
}
for (theta in 1:5) {
c <- 1 / (2 * gamma(theta) + gamma(theta + 0.5))
w1 <- c * 2 / (c * 2 + c); w2 <- c / (c * 2 + c)
s1 <- theta
s2 <- theta + 0.5
n <- 10000
set.seed(123)
u <- rbinom(n, prob = w1, size = 1)
x <- rgamma(n, shape = ifelse(u == 1, s1, s2), scale = 1)
g <- w1 * dgamma(x, shape = s1, scale = 1) +w2 * dgamma(x, shape = s2, scale = 1)
g.true <- c * exp(-x) * (2 * x^(theta - 1) + x^(theta - 0.5))
plot(x,g,main = "ok")
points(x,g.true,col="red")
}
for (theta in 1:5) {
c <- 1 / (2 * gamma(theta) + gamma(theta + 0.5))
w1 <- c * 2 / (c * 2 + c); w2 <- c / (c * 2 + c)
s1 <- theta
s2 <- theta + 0.5
n <- 10000
set.seed(123)
u <- rbinom(n, prob = w1, size = 1)
x <- rgamma(n, shape = ifelse(u == 1, s1, s2), scale = 1)
g <- w1 * dgamma(x, shape = s1, scale = 1) +w2 * dgamma(x, shape = s2, scale = 1)
g.true <- c * exp(-x) * (2 * x^(theta - 1) + x^(theta - 0.5))
plot(x,g,main =paste("theta value", theta)
points(x,g.true,col="red")
for (theta in 1:5) {
c <- 1 / (2 * gamma(theta) + gamma(theta + 0.5))
w1 <- c * 2 / (c * 2 + c); w2 <- c / (c * 2 + c)
s1 <- theta
s2 <- theta + 0.5
n <- 10000
set.seed(123)
u <- rbinom(n, prob = w1, size = 1)
x <- rgamma(n, shape = ifelse(u == 1, s1, s2), scale = 1)
g <- w1 * dgamma(x, shape = s1, scale = 1) +w2 * dgamma(x, shape = s2, scale = 1)
g.true <- c * exp(-x) * (2 * x^(theta - 1) + x^(theta - 0.5))
plot(x,g,main =paste("theta value", theta))
points(x,g.true,col="red")
}
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
dat3 <- data.frame(x.f, q)
View(dat3)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(x,x.f,main =paste("theta value is", theta))
lines(x,q.true,col="red")
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(x,x.f,main =paste("theta value is", theta))
lines(x,q,col="red")
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
ggplot(data = dat3, aes(x = x.f)) +
geom_density(aes(y=..density.. * 70)) +
geom_line(aes(y = q), colour = 'blue') +
xlab("x") + ylab("kernel density")
library(ggplot2)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
ggplot(data = dat3, aes(x = x.f)) +
geom_density(aes(y=..density.. * 70)) +
geom_line(aes(y = q), colour = 'blue') +
xlab("x") + ylab("kernel density")
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
ggplot(data = dat3, aes(x = x.f)) +
geom_density(aes(y=..density.. * 70))
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
ggplot(data = dat3, aes(x = x.f)) +
geom_density(aes(y))
plot(density(x.f))
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
lines(q)
ggplot(data = dat3, aes(x = x.f)) +
geom_density(aes(y=..density.. * 70))
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
lines(q,col="red")
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(density(x.f))
lines(q)
density(q)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(density(q))
plot(density(q))
ggplot(data = dat3, aes(x = x.f)) +
geom_line(aes(y = q), colour = 'blue') +
xlab("x") + ylab("kernel density")
plot(x.f,q)
plot(x.f,q)
plot(density(x.f)*70)
lines(x.f,q,col="red")
plot(density(x.f))
lines(x.f,q,col="red")
plot(density(x.f))
lines(x.f,q,col="red")
plot(density(x.f))
plot(x.f,q,)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(x.f,q,)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(x.f,q/70,)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(x.f,q/70,add=TREU)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
plot(x.f,q/70,add=T)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
lines(x.f,q/70)
lines(sort(x.f),sort(q/70))
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
lines(sort(x.f),sort(q/70))
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
points(x.f,q/70)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
points(x.f,q/70,size=0.1)
x.f <- rep(NA, n)
for (i in 1:n) {
while (TRUE) {
u <- rbinom(1, prob = w1, size = 1)
cand <- rgamma(1, shape = ifelse(u == 1, s1, s2), scale = 1)
ratio <- sqrt(cand + 4)/(2+sqrt(cand))
uni <- runif(1)
if (uni < ratio) break
}
x.f[i] <- cand
}
q <- sqrt(x.f + 4) * x.f^(theta - 1) * exp(-x.f)
plot(density(x.f))
points(x.f,q/70,col="red")
install.packages("HI")
install.packages("HI")
knitr::opts_chunk$set(echo = TRUE)
sim <- mymcmc(niter, thetaInit, x)
delta <- 0.7
n <- 100
set.seed(123)
u <- rbinom(n, prob = delta, size = 1)
x <- rnorm(n, ifelse(u == 1, 7, 10), 1)
logpost <- function(theta, x) {
delta <- theta[1]
mu1 <- theta[2]; mu2 <- theta[3]
sig1 <- theta[4]; sig2 <- theta[5]
re <- sum(log(delta * dnorm(x, mu1,sqrt(sig1)) + (1-delta) * dnorm(x,mu2,sqrt(sig2)))) +
log(dnorm(mu1,0,10) ) + log(dnorm(mu2,0,10) ) +
log(dinvgamma(sig1, 0.5 , 0.1) ) +  log(dinvgamma(sig2, 0.5 , 0.1) )
return(re)
}
mymcmc <- function(niter, thetaInit, x, nburn= 100) {
p <- length(thetaInit)
thetaCurrent <- thetaInit
## define a function for full conditional sampling
logFC <- function(th, idx) {
theta <- thetaCurrent
theta[idx] <- th
logpost(theta, x)
}
out <- matrix(thetaInit, niter, p, byrow = TRUE)
## Gibbs sampling
for (i in 2:niter) {
for (j in 1:p) {
## general-purpose arms algorithm
out[i, j] <- thetaCurrent[j] <- if (j < 2) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 1)),
1, idx = j)
} else if (j < 4 ) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > -30) * (x < 30)),
1, idx = j)
} else {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 100)),
1, idx = j)
}
}
}
out[-(1:nburn), ]
}
niter <- 600; nburn <- 100
thetaInit <- c(0.5, 2, 2, 2, 2)
sim <- mymcmc(niter, thetaInit, x)
densities = dinvgamma(samples, shape=1, scale=1)
install.packages("MCMCpack")
library(MCMCpack)
delta <- 0.7
n <- 100
set.seed(123)
u <- rbinom(n, prob = delta, size = 1)
x <- rnorm(n, ifelse(u == 1, 7, 10), 1)
logpost <- function(theta, x) {
delta <- theta[1]
mu1 <- theta[2]; mu2 <- theta[3]
sig1 <- theta[4]; sig2 <- theta[5]
re <- sum(log(delta * dnorm(x, mu1,sqrt(sig1)) + (1-delta) * dnorm(x,mu2,sqrt(sig2)))) +
log(dnorm(mu1,0,10) ) + log(dnorm(mu2,0,10) ) +
log(dinvgamma(sig1, 0.5 , 0.1) ) +  log(dinvgamma(sig2, 0.5 , 0.1) )
return(re)
}
mymcmc <- function(niter, thetaInit, x, nburn= 100) {
p <- length(thetaInit)
thetaCurrent <- thetaInit
## define a function for full conditional sampling
logFC <- function(th, idx) {
theta <- thetaCurrent
theta[idx] <- th
logpost(theta, x)
}
out <- matrix(thetaInit, niter, p, byrow = TRUE)
## Gibbs sampling
for (i in 2:niter) {
for (j in 1:p) {
## general-purpose arms algorithm
out[i, j] <- thetaCurrent[j] <- if (j < 2) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 1)),
1, idx = j)
} else if (j < 4 ) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > -30) * (x < 30)),
1, idx = j)
} else {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 100)),
1, idx = j)
}
}
}
out[-(1:nburn), ]
}
niter <- 600; nburn <- 100
thetaInit <- c(0.5, 2, 2, 2, 2)
sim <- mymcmc(niter, thetaInit, x)
library(MCMCpack)
delta <- 0.7
n <- 100
set.seed(123)
u <- rbinom(n, prob = delta, size = 1)
x <- rnorm(n, ifelse(u == 1, 7, 10), 1)
logpost <- function(theta, x) {
delta <- theta[1]
mu1 <- theta[2]; mu2 <- theta[3]
sig1 <- theta[4]; sig2 <- theta[5]
re <- sum(log(delta * dnorm(x, mu1,sqrt(sig1)) +(1-delta)*dnorm(x,mu2,sqrt(sig2))))+log(dnorm(mu1,0,10) ) + log(dnorm(mu2,0,10) ) + log(dinvgamma(sig1, 0.5 , 0.1) ) +  log(dinvgamma(sig2, 0.5 , 0.1) )
return(re)
}
mymcmc <- function(niter, thetaInit, x, nburn= 100) {
p <- length(thetaInit)
thetaCurrent <- thetaInit
## define a function for full conditional sampling
logFC <- function(th, idx) {
theta <- thetaCurrent
theta[idx] <- th
logpost(theta, x)
}
out <- matrix(thetaInit, niter, p, byrow = TRUE)
## Gibbs sampling
for (i in 2:niter) {
for (j in 1:p) {
## general-purpose arms algorithm
out[i, j] <- thetaCurrent[j] <- if (j < 2) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 1)),
1, idx = j)
} else if (j < 4 ) {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > -30) * (x < 30)),
1, idx = j)
} else {
HI::arms(thetaCurrent[j], logFC,
function(x, idx) ((x > 0) * (x < 100)),
1, idx = j)
}
}
}
out[-(1:nburn), ]
}
niter <- 600; nburn <- 100
thetaInit <- c(0.5, 2, 2, 2, 2)
sim <- mymcmc(niter, thetaInit, x)
View(sim)
knitr::opts_chunk$set(echo = TRUE)
library(MCMCpack)
hist((sim[,1]), main = 'Delta',xlab = 'Delta')
hist((sim[,2]), main = 'mu1',xlab = 'mu1')
